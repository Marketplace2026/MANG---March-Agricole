<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Reset Password – Sell Live</title>

<meta name="description" content="Reset your Sell Live account password securely.">

<meta name="robots" content="noindex, nofollow">

<link rel="canonical" href="https://marketplace2026.github.io/MANG---March-Agricole/">
<style>
  body, html {
    margin:0; padding:0;
    font-family: Arial, sans-serif;
    background:#f2f7f4;
  }
  main {
    max-width:400px;
    margin:80px auto;
    padding:20px;
    background:white;
    border-radius:10px;
    box-shadow:0 4px 15px rgba(0,0,0,0.1);
    text-align:center;
  }
  h1 { color:#2e8b57; margin-bottom:20px; }
  input {
    width:90%;
    padding:10px;
    margin:10px 0;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:1em;
  }
  button {
    width:95%;
    padding:12px;
    margin-top:15px;
    border:none;
    border-radius:6px;
    background:#2e8b57;
    color:white;
    font-weight:bold;
    cursor:pointer;
    font-size:1em;
    transition:0.2s;
  }
  button:hover { background:#27ae60; }
  .error { color:red; font-size:0.9em; margin-top:10px; }
  .success { color:green; font-size:0.9em; margin-top:10px; }
</style>
</head>

<body>
<main>
  <h1>Réinitialiser le mot de passe</h1>
  <input type="password" id="newPassword" placeholder="Nouveau mot de passe">
  <input type="password" id="confirmPassword" placeholder="Confirmer le mot de passe">
  <button id="resetBtn">Réinitialiser le mot de passe</button>
  <div id="message" class="error"></div>
</main>

<script type="module">
import { supabase } from './supabase.js';

document.addEventListener('DOMContentLoaded', async () => {

  const newPassword = document.getElementById('newPassword');
  const confirmPassword = document.getElementById('confirmPassword');
  const resetBtn = document.getElementById('resetBtn');
  const message = document.getElementById('message');

  // ✅ Vérifie que l'utilisateur est bien en mode recovery
  supabase.auth.onAuthStateChange(async (event, session) => {
    if (event === "PASSWORD_RECOVERY") {
      console.log("Mode récupération actif");
    }
  });

  resetBtn.onclick = async () => {
    message.textContent = "";

    if (!newPassword.value || !confirmPassword.value) {
      message.textContent = "Remplis tous les champs";
      return;
    }

    if (newPassword.value !== confirmPassword.value) {
      message.textContent = "Les mots de passe ne correspondent pas";
      return;
    }

    const { error } = await supabase.auth.updateUser({
      password: newPassword.value
    });

    if (error) {
      message.textContent = error.message;
      return;
    }

    message.className = "success";
    message.textContent = "✅ Mot de passe réinitialisé avec succès !";

    setTimeout(() => {
      window.location.href = "login.html";
    }, 2500);
  };

});
</script>
</body>
</html>
