<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mes Commandes</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif}
body{background:#f4f6f9}
header{background:#4CAF50;color:white;padding:15px;text-align:center}
main{max-width:1100px;margin:30px auto;padding:0 15px}

.user-email{
margin-top:8px;
font-size:14px;
opacity:0.9;
}

h2{margin:20px 0 10px}

.orders-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(330px,1fr));
gap:15px;
}

.order-card{
background:white;
padding:15px;
border-radius:10px;
box-shadow:0 4px 10px rgba(0,0,0,0.05);
transition:0.2s;
}

.order-card:hover{
transform:translateY(-3px);
box-shadow:0 6px 15px rgba(0,0,0,0.08);
}

.order-card p{margin:5px 0;font-size:14px}

.empty{
padding:20px;
background:white;
border-radius:8px;
text-align:center;
color:#888;
}
</style>
</head>

<body>

<header>
<h1>Mes Commandes</h1>
<p class="user-email" id="userEmail"></p>
</header>

<main>

<h2>üõí Commandes que j'ai faites</h2>
<div class="orders-grid" id="buyerOrders"></div>

<h2>üè™ Commandes re√ßues (Je suis vendeur)</h2>
<div class="orders-grid" id="sellerOrders"></div>

</main>

<script type="module">
import { supabase } from './supabase.js';

let currentUser = null;

// ==============================
// IDENTIFICATION UTILISATEUR
// ==============================
async function init() {

  const { data: { session } } = await supabase.auth.getSession();

  if (!session) {
    alert("Vous devez √™tre connect√©.");
    window.location.href = "login.html";
    return;
  }

  currentUser = session.user;

  // üî• Affiche l'email ici
  document.getElementById("userEmail").innerText =
    "Connect√© en tant que : " + currentUser.email;

  console.log("Utilisateur connect√© :", currentUser.id);
  console.log("Email :", currentUser.email);

  loadOrders();
}

init();


// ==============================
// CHARGEMENT DES COMMANDES
// ==============================
async function loadOrders() {

  const buyerDiv = document.getElementById("buyerOrders");
  const sellerDiv = document.getElementById("sellerOrders");

  buyerDiv.innerHTML = "";
  sellerDiv.innerHTML = "";

  // üîπ Commandes acheteur
  const { data: buyerOrders } = await supabase
    .from("orders")
    .select("*")
    .eq("buyer_id", currentUser.id);

  // üîπ Commandes vendeur
  const { data: sellerOrders } = await supabase
    .from("orders")
    .select("*")
    .eq("seller_id", currentUser.id);

  // ===== AFFICHAGE ACHETEUR =====
  if (!buyerOrders || buyerOrders.length === 0) {
    buyerDiv.innerHTML = "<div class='empty'>Aucune commande trouv√©e.</div>";
  } else {
    buyerOrders.forEach(order => {
      buyerDiv.innerHTML += `
        <div class="order-card">
          <p><strong>ID:</strong> ${order.id}</p>
          <p><strong>Montant:</strong> ${order.amount} FCFA</p>
          <p><strong>Status:</strong> ${order.status}</p>
          <p><strong>Date:</strong> ${new Date(order.created_at).toLocaleString()}</p>
        </div>
      `;
    });
  }

  // ===== AFFICHAGE VENDEUR =====
  if (!sellerOrders || sellerOrders.length === 0) {
    sellerDiv.innerHTML = "<div class='empty'>Aucune commande re√ßue.</div>";
  } else {
    sellerOrders.forEach(order => {
      sellerDiv.innerHTML += `
        <div class="order-card">
          <p><strong>ID:</strong> ${order.id}</p>
          <p><strong>Montant:</strong> ${order.amount} FCFA</p>
          <p><strong>Status:</strong> ${order.status}</p>
          <p><strong>Date:</strong> ${new Date(order.created_at).toLocaleString()}</p>
        </div>
      `;
    });
  }
}

</script>

</body>
</html>
